<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" />

    <meta name="generator" content="sphinx-4.4.0, furo 2022.03.04"/>
        <title>System Requirements for Cycle Cloud - pcluster-cmaq documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?digest=935aa2abcc5c1da4283d1dc201fb1f0add16d23a" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?digest=25ceb02ed1c46dc30f2321ff83e92799f69dfdb9" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">pcluster-cmaq  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">pcluster-cmaq  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  
</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container"><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="system-requirements-for-cycle-cloud">
<h1>System Requirements for Cycle Cloud<a class="headerlink" href="#system-requirements-for-cycle-cloud" title="Permalink to this headline">#</a></h1>
<section id="please-set-up-a-alarm-on-azure">
<h2>Please set up a alarm on Azure<a class="headerlink" href="#please-set-up-a-alarm-on-azure" title="Permalink to this headline">#</a></h2>
<p>Set alarm to receive an email alert if you exceed $100 per month (or what ever monthly spending limit you need).
It may be possible to set up daily or weekly spending alarms as well.</p>
</section>
<section id="software-requirements-for-cmaq-on-cyclecloud">
<h2>Software Requirements for CMAQ on CycleCloud<a class="headerlink" href="#software-requirements-for-cmaq-on-cyclecloud" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>Tcsh shell</p></li>
<li><p>Centos7  (tried ubuntu but the module command did not provide updated compilers and openmpi)</p></li>
<li><p>Git</p></li>
<li><p>Compilers (C, C++, and Fortran) - GNU compilers version ≥ 9.2</p></li>
<li><p>MPI (Message Passing Interface) -  OpenMPI ≥ 4.1.0</p></li>
<li><p>NetCDF (with C, C++, and Fortran support)</p></li>
<li><p>I/O API</p></li>
<li><p>Slurm Scheduler</p></li>
</ul>
</section>
<section id="hardware-requirements">
<h2>Hardware Requirements<a class="headerlink" href="#hardware-requirements" title="Permalink to this headline">#</a></h2>
<section id="recommended-minimum-requirements">
<h3>Recommended Minimum Requirements<a class="headerlink" href="#recommended-minimum-requirements" title="Permalink to this headline">#</a></h3>
<p>The size of hardware depends on the domain size and resolution for  your CMAQ case, and how quickly your turn-around requirements are.
Larger hardware and memory configurations are also required for instrumented versions of CMAQ incuding CMAQ-ISAM and CMAQ-DDM3D.</p>
</section>
</section>
<section id="azure-cyclecloud">
<h2>Azure CycleCloud<a class="headerlink" href="#azure-cyclecloud" title="Permalink to this headline">#</a></h2>
<p>Azure CycleCloud Provides the simplest way to manage HPC workloads using any scheduler (like Slurm, Grid Engine, HPC Pack, HTCondor, LSF, PBS Pro, or Symphony), on Azure</p>
<p>CycleCloud allows you to:</p>
<ul class="simple">
<li><p>Deploy full clusters and other resources, including scheduler, compute VMs, storage, networking, and cache</p></li>
<li><p>Orchestrate job, data, and cloud workflows</p></li>
<li><p>Give admins full control over which users can run jobs, as well as where and at what cost</p></li>
<li><p>Customize and optimize clusters through advanced policy and governance features, including cost controls, Active Directory integration, monitoring, and reporting</p></li>
<li><p>Use your current job scheduler and applications without modification</p></li>
<li><p>Take advantage of built-in autoscaling and battle-tested reference architectures for a wide range of HPC workloads and industries</p></li>
</ul>
<p><a href="https://docs.microsoft.com/en-us/azure/architecture/topics/high-performance-computing#azure-cyclecloud">High Performance Computing on Azure CycleCloud</a></p>
<p><a href="https://docs.microsoft.com/en-us/azure/cyclecloud/?view=cyclecloud-8">Azure CycleCloud</a></p>
</section>
<section id="ensure-your-vcpu-quota-has-been-increased-before-attempting-to-run-large-scale-workloads">
<h2>Ensure your vCPU quota has been increased before attempting to run large-scale workloads.<a class="headerlink" href="#ensure-your-vcpu-quota-has-been-increased-before-attempting-to-run-large-scale-workloads" title="Permalink to this headline">#</a></h2>
<p><a href="https://docs.microsoft.com/en-us/azure/virtual-machines/linux/quotas">Azure VM Quotas</a></p>
<section id="recommended-cycle-cloud-configuration-for-conus-domain">
<h3>Recommended Cycle Cloud Configuration for CONUS Domain<a class="headerlink" href="#recommended-cycle-cloud-configuration-for-conus-domain" title="Permalink to this headline">#</a></h3>
<p>Scheduler node:</p>
<ul class="simple">
<li><p>D12v2</p></li>
</ul>
<p>Compute Node for HTC Queue - used for Post-Processing (combine, etc):</p>
<ul class="simple">
<li><p>F2sV2</p></li>
</ul>
<p>Compute Node for HPC Queue - used to run CMAQ:</p>
<ul class="simple">
<li><p>HBv3-120 instance running Centos7</p></li>
</ul>
<p><a href="https://docs.microsoft.com/en-us/azure/virtual-machines/workloads/hpc/hbv3-series-overview#software-specifications">HBv3-series Software Specification</a></p>
<p>448 GB of RAM, and no hyperthreading with 350 GB/sec of memory bandwidth, up to 32 MB of L3 cache per core, up to 7 GB/s of block device SSD performance, and clock frequencies up to 3.675 GHz.</p>
<p>Figure 1. Cycle Cloud Recommended Cluster Configuration (Number of compute nodes depends on setting for NPCOLxNPROW and #SBATCH –nodes=XX #SBATCH –ntasks-per-node=YY )</p>
<p><img alt="Azure Minimum Viable Product Configuration" src="../_images/microsoft_azure_minimum_viable_product.png"/></p>
</section>
<section id="azure-cyclecloud-specifies-what-resource-to-use-for-disks-scheduler-node-and-compute-nodes">
<h3>Azure CycleCloud specifies what resource to use for disks, scheduler node, and compute nodes.<a class="headerlink" href="#azure-cyclecloud-specifies-what-resource-to-use-for-disks-scheduler-node-and-compute-nodes" title="Permalink to this headline">#</a></h3>
<p>Cycle Cloud simply tries to schedule the job according to the slurm scheduler instructions. Slurm controls the launch, terminate, and maintain resources.
If you try to allocate more nodes than are available in the Cycle Cloud Configuration, then you will need to
edit the HPC config in the cyclecloud web interface to set the CPUs to 480 or more and then run the following on the scheduler node the changes should get picked up:</p>
<p><code class="docutils literal notranslate"><span class="pre">cd</span> <span class="pre">/opt/cycle/slurm</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">./cyclecloud_slurm.sh</span> <span class="pre">scale</span></code></p>
<p>Number of compute nodes dispatched by the slurm scheduler is specified in the run script using #SBATCH –nodes=XX #SBATCH –ntasks-per-node=YY where the maximum value of tasks per node or YY limited by many CPUs are on the compute node.</p>
<p>For HBv3-120, there are 120 CPUs, so maximum value of YY is 120 or –ntask-per-node=120.</p>
<p>If running a job with 180 processors, this would require the –nodes=XX or XX to be set to 2 compute nodes, as 90x2=180.</p>
<p>The setting for NPCOLxNPROW must also be a maximum of 180, ie. 18 x 10 or 10 x 18 to use all of the CPUs in the parallel cluster.</p>
<p><a href="https://docs.microsoft.com/en-us/azure/virtual-machines/hbv3-series">HBv3-120 instance </a></p>
<p>Software:</p>
<ul class="simple">
<li><p>Centos7</p></li>
<li><p>Spot or OnDemand Pricing</p></li>
<li><p>/shared/build volume install software from git repo</p></li>
<li><ol class="arabic simple">
<li><p>TB Shared file system</p></li>
</ol>
</li>
<li><p>Slurm Placement Group enabled</p></li>
<li><p>Elastic Fabric Adapter Enabled on HBv3-120</p></li>
</ul>
<p><a href="https://azure.com/e/a5d6f8654d634e8b93973574cbda428d">Azure HBv3-120 Pricing</a></p>
<p><img alt="Azure HPC HBv3_120pe Pricing" src="user_guide_cyclecloud/Azure_HPC_HBv3_Pricing.png"/></p>
<p>Table 1. Azure Instance On-Demand versus Spot Pricing (price is subject to change)</p>
<div class="table-wrapper"><table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Instance Name</p></th>
<th class="head"><p>CPUs</p></th>
<th class="head"><p>RAM</p></th>
<th class="head"><p>Memory Bandwidth</p></th>
<th class="head"><p>Network Bandwidth</p></th>
<th class="head"><p>Linux On-Demand Price</p></th>
<th class="head"><p>Linux Spot Price</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>HBv3-120</p></td>
<td><p>120</p></td>
<td><p>448 GiB</p></td>
<td><p>350 Gbps</p></td>
<td><p>200 Gbps(Infiniband)</p></td>
<td><p>$3.6/hour</p></td>
<td><p>$1.4/hour</p></td>
</tr>
</tbody>
</table></div>
<p>Table 2. Timing Results for CMAQv5.3.3 2 Day CONUS2 Run on Cycle Cloud with D12v2 schedulare node and HBv3-120 Compute Nodes</p>
<div class="table-wrapper"><table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Number of PEs</p></th>
<th class="head"><p>#Nodesx#CPU</p></th>
<th class="head"><p>NPCOLxNPROW</p></th>
<th class="head"><p>Day1 Timing (sec)</p></th>
<th class="head"><p>Day2 Timing (sec)</p></th>
<th class="head"><p>Total Time(2days)(sec)</p></th>
<th class="head"><p>SBATCH –exclusive</p></th>
<th class="head"><p>Data Imported or Copied</p></th>
<th class="head"><p>DisableSimultaneousMultithreading</p></th>
<th class="head"><p>Answers Matched</p></th>
<th class="head"><p>Cost using Spot Pricing</p></th>
<th class="head"><p>Cost using On Demand Pricing</p></th>
<th class="head"><p>compiler flag</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>90</p></td>
<td><p>1x90</p></td>
<td><p>9x10</p></td>
<td><p>3153.33</p></td>
<td><p>2758.12</p></td>
<td><p>5911.45</p></td>
<td><p>no</p></td>
<td><p>copied</p></td>
<td><p>false</p></td>
<td><p></p></td>
<td><p>$1.4/hr * 2 nodes * 1.642 hr = $4.59</p></td>
<td><p>$3.6/hr * 1 nodes * 1.642 hr = $ $5.911</p></td>
<td><p>without -march=native compiler flag</p></td>
</tr>
<tr class="row-odd"><td><p>120</p></td>
<td><p>1x120</p></td>
<td><p>10x12</p></td>
<td><p>2829.84</p></td>
<td><p>2516.07</p></td>
<td><p>5345.91</p></td>
<td><p>no</p></td>
<td><p>copied</p></td>
<td><p>false</p></td>
<td><p></p></td>
<td><p>$1.4/hr * 2 nodes * 1.484 hr = $4.15</p></td>
<td><p>$3.6/hr * 1 nodes * 1.484 hr = $5.34</p></td>
<td><p>without -march=native compiler flag</p></td>
</tr>
<tr class="row-even"><td><p>180</p></td>
<td><p>2x90</p></td>
<td><p>10x18</p></td>
<td><p>2097.37</p></td>
<td><p>1809.84</p></td>
<td><p>3907.21</p></td>
<td><p>no</p></td>
<td><p>copied</p></td>
<td><p>false</p></td>
<td><p></p></td>
<td><p>$1.4/hr * 2 nodes * 1.08 hr = $3.03</p></td>
<td><p>$3.6/hr * 2 nodes * 1.08 hr = $7.81</p></td>
<td><p>with -march=native compiler flag</p></td>
</tr>
<tr class="row-odd"><td><p>180</p></td>
<td><p>2x90</p></td>
<td><p>10 x 18</p></td>
<td><p>1954.20</p></td>
<td><p>1773.86</p></td>
<td><p>3728.06</p></td>
<td><p>no</p></td>
<td><p>copied</p></td>
<td><p>false</p></td>
<td><p></p></td>
<td><p>$1.4/hr * 2 nodes * 1.036 hr = $2.9</p></td>
<td><p>$3.6/hr * 2 nodes * 1.036 hr = $7.46</p></td>
<td><p>without -march=native compiler flag</p></td>
</tr>
<tr class="row-even"><td><p>240</p></td>
<td><p>2x120</p></td>
<td><p>20x12</p></td>
<td><p>1856.50</p></td>
<td><p>1667.68</p></td>
<td><p>3524.18</p></td>
<td><p>no</p></td>
<td><p>copied</p></td>
<td><p>false</p></td>
<td><p></p></td>
<td><p>$1.4/hr * 2 nodes * .97 hr = $2.716</p></td>
<td><p>$3.6/hr * 2 nodes * .97 hr = $6.984</p></td>
<td><p>without -march=native compiler flag</p></td>
</tr>
<tr class="row-odd"><td><p>270</p></td>
<td><p>3x90</p></td>
<td><p>15x18</p></td>
<td><p>1703.19</p></td>
<td><p>1494.17</p></td>
<td><p>3197.36</p></td>
<td><p>no</p></td>
<td><p>copied</p></td>
<td><p>false</p></td>
<td><p></p></td>
<td><p>$1.4/hr * 3 nodes * .888hr = $3.72</p></td>
<td><p>3.6/hr * 3 nodes * .888 = $9.59</p></td>
<td><p>with -march=native compiler flag</p></td>
</tr>
<tr class="row-even"><td><p>360</p></td>
<td><p>3x120</p></td>
<td><p>20x18</p></td>
<td><p>1520.29</p></td>
<td><p>1375.54</p></td>
<td><p>2895.83</p></td>
<td><p>no</p></td>
<td><p>copied</p></td>
<td><p>false</p></td>
<td><p></p></td>
<td><p>$1.4/hr * 3 nodes * .804 = $3.38</p></td>
<td><p>3.6/hr * 3 nodes * .804 = $8.687</p></td>
<td><p>with -march=native compiler flag</p></td>
</tr>
<tr class="row-odd"><td><p>960</p></td>
<td><p>8x120</p></td>
<td><p>30x32?</p></td>
<td><p>1223.52</p></td>
<td><p>1126.19</p></td>
<td><p>2349.71</p></td>
<td><p>no</p></td>
<td><p>copied</p></td>
<td><p>false</p></td>
<td><p></p></td>
<td><p>$1.4/hr * 8 nodes * .653 = $7.31</p></td>
<td><p>3.6/hr * 8 nodes * .653 = $18.8</p></td>
<td><p>with -march=native compiler flag</p></td>
</tr>
</tbody>
</table></div>
<p>Total HBv3-120 compute cost of Running Benchmarking Suite using SPOT pricing = $1.4/hr
<a href="https://azure.microsoft.com/en-us/pricing/details/virtual-machines/linux/">Azure Spot and On-Demand Pricing</a></p>
<p>Figures: todo - need screenshots of Azure Pricing from Rob Zelt</p>
<p>Figure 2. Cost by Instance Type - update for Azure</p>
<p><img alt="Azure Cost Management Console - Cost by Instance Type" src="qa_plots/cost_plots/Azure_Bench_Cost.png"/></p>
<p>Figure 3. Cost by Usage Type - Azure Console</p>
<p><img alt="Azure Cost Management Console - Cost by Usage Type" src="qa_plots/cost_plots/Azure_Bench_Usage_Type_Cost.png"/></p>
<p>Figure 4. Cost by Service Type - Azure Console</p>
<p><img alt="Azure Cost Management Console - Cost by Service Type" src="qa_plots/cost_plots/Azure_Bench_Service_Type_Cost.png"/></p>
<p>Scheduler node D12v2 compute cost = entire time that the parallel cluster is running ( creation to deletion) = 6 hours * $0.?/hr = $ ? using spot pricing, 6 hours * $?/hr = $? using on demand pricing.</p>
<p>Total HBv3-120 cost of Running Benchmarking Suite using ONDEMAND pricing = $52.00 (sum of all ondemand cost for Table 2)</p>
<p>Using 360 cpus on the Cycle Cloud Cluster, it would take ~6.11 days to run a full year, using 3 HBv3-120 compute nodes.</p>
<p>Table 3. Extrapolated Cost of HBv3-120 used for CMAQv5.3.3 Annual Simulation based on 2 day CONUS benchmark</p>
<div class="table-wrapper"><table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Benchmark Case</p></th>
<th class="head"><p>Number of PES</p></th>
<th class="head"><p>Number of HBv3-120 Nodes</p></th>
<th class="head"><p>Pricing</p></th>
<th class="head"><p>Cost per node</p></th>
<th class="head"><p>Time to completion (hour)</p></th>
<th class="head"><p>Extrapolate Cost for Annual Simulation</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>2 day CONUS</p></td>
<td><p>360</p></td>
<td><p>3</p></td>
<td><p>SPOT</p></td>
<td><p>1.4/hour</p></td>
<td><p>2895.83/3600 = .8044</p></td>
<td><p>.8044/2 * 365 = 147 hours/node * 3 nodes = 441 * $1.4 = $617.4</p></td>
</tr>
<tr class="row-odd"><td><p>2 day CONUS</p></td>
<td><p>360</p></td>
<td><p>3</p></td>
<td><p>ONDEMAND</p></td>
<td><p>3.6/hour</p></td>
<td><p>2895.83/3600 = .8044</p></td>
<td><p>.8044/2 * 365 = 147 hours/node * 3 nodes = 441 * $3.6 = $1,587.6</p></td>
</tr>
</tbody>
</table></div>
<p><a href="https://docs.microsoft.com/en-us/azure/virtual-machines/disks-shared">Azure SSD Disk Pricing</a>
<a href="https://azure.microsoft.com/en-us/pricing/details/managed-disks/">Azure SSD Disk Pricing</a></p>
<p>Table 4. Shared SSD File System Pricing</p>
<div class="table-wrapper"><table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Storage Type</p></th>
<th class="head"><p>Storage options</p></th>
<th class="head"><p>Max IOPS (Max IOPS w/ bursting)</p></th>
<th class="head"><p>Pricing (monthly)</p></th>
<th class="head"><p>Pricing</p></th>
<th class="head"><p>Price per mount per month (Shared Disk)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Persistant 1TB</p></td>
<td><p>200 MB/s/TB</p></td>
<td><p>5,000 (30,000)</p></td>
<td><p>$122.88/month</p></td>
<td><p>$6.57</p></td>
<td><p></p></td>
</tr>
</tbody>
</table></div>
<p>Table 5. Extrapolated Cost of File system for CMAQv5.3.3 Annual Simulation based on 2 day CONUS benchmark</p>
<p>Need to create table</p>
<p>Also need estimate for Archive Storage cost for storing an annual simulation</p>
</section>
</section>
<section id="recommended-workflow">
<h2>Recommended Workflow<a class="headerlink" href="#recommended-workflow" title="Permalink to this headline">#</a></h2>
<p>Post-process monthly save output and/or post-processed outputs to archive storage at the end of each month.</p>
<p>Goal is to develop a reproducable workflow that does the post processing after every month, and then copies what is required to archive storage, so that only 1 month of output is stored at a time on the /shared/data scratch file system.
This workflow will help with preserving the data in case the cluster or scratch file system gets pre-empted.</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2022, Liz Adams
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">System Requirements for Cycle Cloud</a><ul>
<li><a class="reference internal" href="#please-set-up-a-alarm-on-azure">Please set up a alarm on Azure</a></li>
<li><a class="reference internal" href="#software-requirements-for-cmaq-on-cyclecloud">Software Requirements for CMAQ on CycleCloud</a></li>
<li><a class="reference internal" href="#hardware-requirements">Hardware Requirements</a><ul>
<li><a class="reference internal" href="#recommended-minimum-requirements">Recommended Minimum Requirements</a></li>
</ul>
</li>
<li><a class="reference internal" href="#azure-cyclecloud">Azure CycleCloud</a></li>
<li><a class="reference internal" href="#ensure-your-vcpu-quota-has-been-increased-before-attempting-to-run-large-scale-workloads">Ensure your vCPU quota has been increased before attempting to run large-scale workloads.</a><ul>
<li><a class="reference internal" href="#recommended-cycle-cloud-configuration-for-conus-domain">Recommended Cycle Cloud Configuration for CONUS Domain</a></li>
<li><a class="reference internal" href="#azure-cyclecloud-specifies-what-resource-to-use-for-disks-scheduler-node-and-compute-nodes">Azure CycleCloud specifies what resource to use for disks, scheduler node, and compute nodes.</a></li>
</ul>
</li>
<li><a class="reference internal" href="#recommended-workflow">Recommended Workflow</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/scripts/furo.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    </body>
</html>